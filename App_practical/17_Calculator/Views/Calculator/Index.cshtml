@{
    ViewData["Title"] = "Калькулятор";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

<style>
body {
        background-color: #f5f5f5;
        color: #222;
    font-family: 'Segoe UI', sans-serif;
}

.calc-container {
    max-width: 360px;
    margin: 50px auto;
    background: #1e1e1e;
    border-radius: 25px;
    padding: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.5);
}

.display {
    background: #000;
    color: #00ff88;
    font-size: 2.5rem;
    text-align: right;
    padding: 15px;
    border-radius: 20px;
    margin-bottom: 15px;
    height: 70px;
    box-shadow: inset 0 2px 8px rgba(0,0,0,0.6);
    overflow: hidden;
    white-space: nowrap;
    transition: font-size 0.2s ease;
}

.btn {
    border: none;
    border-radius: 15px;
    margin-bottom: 10px;
    font-size: 1.4rem;
    height: 70px;
    color: white;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    transition: all 0.2s ease;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.4);
}

.btn:active {
    transform: translateY(2px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.btn-num { background: linear-gradient(145deg, #444, #222); }
.btn-op { background: linear-gradient(145deg, #ff9500, #e08b00); }
.btn-equal { background: linear-gradient(145deg, #00b894, #00a37a); }
.btn-func { background: linear-gradient(145deg, #666, #444); }

.btn.active {
    transform: scale(0.95);
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

    @@media (max-width: 400px) {
    .btn { height: 60px; font-size: 1.2rem; }
}
</style>

<div class="calc-container text-center">
    <div id="display" class="display">0</div>

    <div class="row mb-2">
        <div class="col-3"><button class="btn btn-func w-100" onclick="clearDisplay()">C</button></div>
        <div class="col-3"><button class="btn btn-func w-100" onclick="backspace()">←</button></div>
        <div class="col-3"><button class="btn btn-op w-100" onclick="setOp('/')">÷</button></div>
        <div class="col-3"><button class="btn btn-op w-100" onclick="setOp('*')">×</button></div>
    </div>

    <div class="row mb-2">
        <div class="col-3"><button class="btn btn-num w-100" onclick="appendNum('7')">7</button></div>
        <div class="col-3"><button class="btn btn-num w-100" onclick="appendNum('8')">8</button></div>
        <div class="col-3"><button class="btn btn-num w-100" onclick="appendNum('9')">9</button></div>
        <div class="col-3"><button class="btn btn-op w-100" onclick="setOp('-')">−</button></div>
    </div>

    <div class="row mb-2">
        <div class="col-3"><button class="btn btn-num w-100" onclick="appendNum('4')">4</button></div>
        <div class="col-3"><button class="btn btn-num w-100" onclick="appendNum('5')">5</button></div>
        <div class="col-3"><button class="btn btn-num w-100" onclick="appendNum('6')">6</button></div>
        <div class="col-3"><button class="btn btn-op w-100" onclick="setOp('+')">+</button></div>
    </div>

    <div class="row mb-2">
        <div class="col-3"><button class="btn btn-num w-100" onclick="appendNum('1')">1</button></div>
        <div class="col-3"><button class="btn btn-num w-100" onclick="appendNum('2')">2</button></div>
        <div class="col-3"><button class="btn btn-num w-100" onclick="appendNum('3')">3</button></div>
        <div class="col-3"><button class="btn btn-equal w-100" onclick="calculate()">=</button></div>
    </div>

    <div class="row">
        <div class="col-8"><button class="btn btn-num w-100" onclick="appendNum('0')">0</button></div>
        <div class="col-4"><button class="btn btn-num w-100" onclick="appendNum('.')">.</button></div>
    </div>
</div>

<script>
let display = document.getElementById("display");
let num1 = "";
let num2 = "";
let operation = "";
let isSecond = false;

// Обновление дисплея с динамическим шрифтом
    function updateDisplay(value) {
        if (!isNaN(value) && value.toString().length > 12) {
            value = Number(value).toExponential(5); // 5 знаков после точки
        }
        display.textContent = value;
        display.style.fontSize = "2.5rem";
    }

// Кнопки
function appendNum(num) {
    if (!isSecond) { num1 += num; updateDisplay(num1); }
    else { num2 += num; updateDisplay(num2); }
}

function setOp(op) {
    if (num1 === "") return;
    operation = op;
    isSecond = true;
}

function clearDisplay() { num1 = ""; num2 = ""; operation = ""; isSecond = false; updateDisplay("0"); }

function backspace() {
    if (!isSecond) { num1 = num1.slice(0,-1); updateDisplay(num1 || "0"); }
    else { num2 = num2.slice(0,-1); updateDisplay(num2 || "0"); }
}

// AJAX вычисление
async function calculate() {
    if (num1 === "" || num2 === "" || operation === "") return;

    const params = new URLSearchParams({ num1, num2, operation });
    const response = await fetch("/Calculator/Calculate", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: params
    });

    const data = await response.json();

    if (data.message) updateDisplay(data.message);
    else {
        updateDisplay(data.result);
        num1 = data.result;
        num2 = "";
        isSecond = false;
    }
}

// Анимация нажатия кнопок
document.querySelectorAll('.btn').forEach(b => {
    b.addEventListener('click', () => {
        b.classList.add('active');
        setTimeout(() => b.classList.remove('active'), 100);
    });
});
</script>


